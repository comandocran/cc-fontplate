/**
 * A function to overlay a dynamically created baseline grid
 * on a webpage.
 *
 * @version 0.9.8
 * @author John Keyes <john@keyes.ie>
 * @copyright Copyright (c) 2011, John Keyes
 * @link https://github.com/jkeyes/baseline
 * @license http://jkeyes.mit-license.org/
 *
 */function getDimension(e,t){if(e===window){var n=e.document.documentElement["client"+t],r=e.document.body;return e.document.compatMode==="CSS1Compat"&&n||r&&r["client"+t]||n}return Math.max(e.documentElement["client"+t],e.body["scroll"+t],e.documentElement["scroll"+t],e.body["offset"+t],e.documentElement["offset"+t])}var merge=function(e,t){for(prop in e){if(prop in t)continue;t[prop]=e[prop]}},Baseliner=function(e){var t={gridColor:[179,187,197],gridHeight:24,gridOpacity:80,gridSpace:1};if(e==null)e={};else{var n=parseInt(e);n!=0&&!isNaN(n)&&(e={gridHeight:n})}merge(t,e);this.opts=e;var r=this;this.overlay_id="baseline-overlay";this.overlay=null;this.showText=document.createTextNode("Show vertical rhythm");this.hideText=document.createTextNode("Hide vertical rhythm");this.resize=function(){if(!this.overlay)return;height=getDimension(document,"Height");width=getDimension(window,"Width");this.overlay.style.width=width+"px";this.overlay.style.height=height+"px"};this.create=function(){var e=document.getElementById(this.overlay_id);if(e)return;this.overlay=document.createElement("div");this.overlay.id=this.overlay_id;document.body.appendChild(this.overlay);this.overlay.style.background="url(http://baselinebg.keyes.ie/?h="+this.opts.gridHeight+"&r="+this.opts.gridColor[0]+"&g="+this.opts.gridColor[1]+"&b="+this.opts.gridColor[2]+"&s="+this.opts.gridSpace+") repeat";this.overlay.style.position="absolute";this.overlay.style.top="0px";this.overlay.style.left="0px";this.overlay.style.zIndex=9998;this.overlay.style.opacity=this.opts.gridOpacity/100;this.resize()};this.toggle=function(e){if(e){var t=document.getElementById(this.overlay_id);t&&document.body.removeChild(t)}this.create();if(e||this.overlay.style.display!="block"){this.showText.parentNode&&this.overlay_it.replaceChild(this.hideText,this.showText);this.overlay.style.display="block"}else{this.hideText.parentNode&&this.overlay_it.replaceChild(this.showText,this.hideText);this.overlay.style.display="none"}};this.refresh=function(e){var e=parseInt(e);if(e==0||isNaN(e)){this.value=r.opts.gridHeight;r.grid_size.style.backgroundColor="red";r.grid_size.style.color="white";return}r.grid_size.style.backgroundColor="white";r.grid_size.style.color="green";if(r.overlay){document.body.removeChild(r.overlay);r.overlay=null}r.opts.gridHeight=e;r.toggle(!0)};init=function(){switch(r.opts.gridColor){case"green":r.opts.gridColor=[0,255,0];break;case"blue":r.opts.gridColor=[0,0,255];break;case"red":r.opts.gridColor=[255,0,0];break;case"black":r.opts.gridColor=[0,0,0]}var e=document.createElement("a");e.setAttribute("href","");e.id="show";e.style.color="#EEE";e.appendChild(r.showText);e.onclick=function(e){if(!e)var e=window.event;r.toggle();e.cancelBubble=!0;if(e.stopPropagation){e.stopPropagation();e.preventDefault()}return!1};r.overlay_it=e;var t=document.createElement("input");t.size=3;t.value=r.opts.gridHeight;t.style.textAlign="center";t.style.border="1px solid #CCC";t.style.padding="1px";r.grid_size=t;var n=document.createElement("div");n.style.position="relative";n.style.padding=0;n.style.zIndex=2e4;var i=document.createElement("div");i.id="overlay-it";i.appendChild(e);n.appendChild(i);document.body.appendChild(n);var s,o=function(){window.clearTimeout(s);s=window.setTimeout(function(){r.refresh(t.value)},400)};t.onchange=t.onkeyup=o;window.onresize=function(){r.resize()};document.onkeyup=function(e){if(!t)var t=window.event;var n=t.keyCode||t.which;if(n==27){window.clearTimeout(s);s=window.setTimeout(function(){r.toggle()},400)}}};init()};